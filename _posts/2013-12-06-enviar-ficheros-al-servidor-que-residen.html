---
layout: post
title: Enviar ficheros al servidor que residen en la máquina cliente mediante http
  POST
date: '2013-12-06T19:41:00.000+01:00'
author: Pere Vilas
tags:
- javascript
- chrome
modified_time: '2013-12-06T20:34:56.801+01:00'
blogger_id: tag:blogger.com,1999:blog-9191328551308072706.post-2867579914809147389
blogger_orig_url: http://www.pvilas.com/2013/12/enviar-ficheros-al-servidor-que-residen.html
---

Siguiendo con el <a href="http://www.pvilas.com/2013/12/django-hacer-post-desde-javascript-con.html" target="_blank">último artículo</a>, supongamos que lo que queremos es enviar al servidor una o varias imágenes que&nbsp;<b>están en la máquina cliente</b>. Este es un tema muy espinoso y lo más recomendable es instalar un servidor web en la máquina cliente y hacer que el servidor vaya a buscar esos ficheros.<br /><br />También es cierto que por tema de "atomicidad" queda más bonito enviar imágenes y datos en un solo POST que sólo puede o tener éxito o fallar.<br /><br />Si en concreto usamos chrome en el cliente, podemos hacer un sencillo "work arround" instalando una extensión de chrome que pida la lectura de unos ficheros en concreto y dándole permisos. Esto tiene la ventaja de que hacemos un solo POST con toda la información necesaria.<br /><br />Para acceder a los ficheros en el cliente, primero creamos el manifiesto de la extensión de chrome con la lista de ficheros a los que queremos acceder, que deben estar todos en el mismo directorio. El manifiesto también lo guardamos en ese directorio.<br /><br /><span style="font-family: inherit;">manifest.json</span><br /><pre class="brush:javascript;">{<br />  "name": "File holder",<br />  "manifest_version": 2,<br />  "version": "1.0",<br />  "web_accessible_resources": ["imagen1.jpg", "imagen2.jpg", "imagen3.jpg"]<br />}<br /></pre><br />Ahora, instalamos la extensión: Vamos a chrome-&gt;<i>extensions</i>, activamos&nbsp;<i>developer mod</i>e y hacemos&nbsp;<i>Load unpacked extension</i>. A partir de este momento, podemos acceder las imágenes locales desde el navegador con<br /><div style="text-align: center;"><i><b>chrome-extension://[app-id]/[imagen]</b></i></div><br />donde [app-id] es el id de aplicación que nos sale cuando instalamos &nbsp;la extensión. Ya podemos acceder a los ficheros locales con el protocolo chrome-extension, por ejemplo con<br /><br /><div style="text-align: center;">chrome-extension://debeanplnpndkfnlbalbmkikofkghfmk/imagen1.jpg</div><br />Podemos enviar la imagen al servidor mediante un POST, así:<br /><br /><pre class="brush:javascript;">    $("#bt_envia").on("click", function (e) {<br /><br />        var x = new XMLHttpRequest();<br />        x.onload = function() {<br />            // Create a form<br />            var fd = new FormData();<br />            fd.append("upfile", x.response); <br />            fd.append("csrfmiddlewaretoken", "{{ "{{" }} csrf_token }}");<br /><br />            // Upload to your server<br />            var y = new XMLHttpRequest();<br />            y.onload = function() {<br />                alert('File uploaded!');<br />            };<br />            y.open('POST', '/gestion/prova/');<br />            y.send(fd);<br />        };<br />        x.responseType = 'blob';    <br />        x.open('GET', 'chrome-extension://debeanplnpndkfnlbalbmkikofkghfmk/foto.jpg');<br />        x.send();<br /><br />    });<br /></pre><br /><br /><span style="font-size: x-small;">Fuente: varios en stackoverflow y</span><br /><a href="http://stackoverflow.com/questions/10611796/is-there-any-way-to-load-a-local-js-file-dynamically">http://stackoverflow.com/questions/10611796/is-there-any-way-to-load-a-local-js-file-dynamically</a>