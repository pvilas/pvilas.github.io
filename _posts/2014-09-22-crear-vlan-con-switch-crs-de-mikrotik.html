---
layout: post
title: Crear VLAN con switch CRS de Mikrotik
date: '2014-09-22T02:00:00.003+02:00'
author: Pere Vilas
tags:
- mikrotik
modified_time: '2014-09-22T18:02:32.665+02:00'
blogger_id: tag:blogger.com,1999:blog-9191328551308072706.post-3193365556764453104
blogger_orig_url: http://www.pvilas.com/2014/09/crear-vlan-con-switch-crs-de-mikrotik.html
---

<h1 id="crear-una-vlan-con-switch-mikrotik-serie-crs-a-partir-de-routeros-v612">Crear una VLAN con switch Mikrotik serie CRS (A partir de RouterOS: v6.12)</h1> <p>La serie CRS lleva un chip dedicado a funciones de switch aunque según el propio <a href="http://wiki.mikrotik.com/wiki/Manual:CRS_examples">manual</a>:</p> <blockquote>  <p>Note: Multiple master-port configuration is designed as fast and simple port isolation solution, but it limits part of VLAN functionality supported by CRS switch-chip. For advanced configurations use one master-port within CRS switch chip for all ports, configure VLANs and isolate port groups with port isolation profile configuration.</p></blockquote> <p>Es decir que si usamos la típica configuración de crear un puerto master para uplink y los demás esclavos o haciendo bridges, perdemos “part of VLAN functionality”, sin especificar cuál.</p> <p>Siguiendo la recomendación de la nota, la siguiente configuración primero </p> <ul><li>aisla los puertos 9 a 16 y después </li><li>crea una VLAN usando el 9 como trunk/uplink y el resto como access.</li></ul> <h2 id="1-aislar-los-puertos-de-la-vlan">1. Aislar los puertos de la VLAN</h2> <p>El aislamiento de puertos se suele usar para VLAN privadas cuando:</p> <ol><li>Uno o más puertos son compartidos por todos los usuarios para acceder a un gateway o un router.</li><li>Puertos aislados para visitantes ocasionales. La comunicación es sólo a un puerto de uplink (con acceso a Internet por ejemplo).</li><li>Comunicar entre si un grupo de usuarios de un departamento. La comunicación puede establecerse <strong>entre</strong> los miembros de la departamento y el puerto de uplink. El esquema habitual es compartir impresoras o algún dispositivo.</li></ol> <p>Los Cloud Router Switches de Mikrotik tienen varios perfiles de aislamiento predefinidos:</p> <ol><li>Puertos de uplink: perfil de aislamiento 0.</li><li>Puertos aislados (sin contacto con otros puertos pero tal vez con el de uplink): perfil de aislamiento 1.</li><li>Departamentos del 0 al 30: perfil de aislamiento del 2 al 33. </li></ol>   <h3 id="configuramos-el-puerto-de-uplink-setear-con-el-profile-0-uplink-el-puerto-9">Configuramos el puerto de uplink: Setear con el profile 0 (uplink) el puerto 9</h3>   <pre class="prettyprint"><code class=" hljs cs">/<span class="hljs-keyword">interface</span> ethernet <span class="hljs-keyword">switch</span> port<br /><span class="hljs-keyword">set</span> ether9 isolation-leakage-profile-<span class="hljs-keyword">override</span>=<span class="hljs-number">0</span></code></pre>   <h3 id="configuramos-el-departamento-le-asignamos-el-perfil-2-comunidad-pueden-verse-entre-ellos">Configuramos el departamento. Le asignamos el perfil 2 (comunidad). Pueden verse entre ellos.</h3>   <pre class="prettyprint"><code class=" hljs lasso">/interface ethernet switch port<br /><span class="hljs-built_in">set</span> ether10 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether11 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether12 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether13 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether14 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether15 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><span class="hljs-built_in">set</span> ether16 isolation<span class="hljs-attribute">-leakage</span><span class="hljs-attribute">-profile</span><span class="hljs-attribute">-override</span><span class="hljs-subst">=</span><span class="hljs-number">2</span><br /><br />/interface ethernet switch port<span class="hljs-attribute">-isolation</span><br />add port<span class="hljs-attribute">-profile</span><span class="hljs-subst">=</span><span class="hljs-number">2</span> ports<span class="hljs-subst">=</span>ether9,ether10,ether11,ether12, ether13,ether14,ether15,ether16 <span class="hljs-keyword">type</span><span class="hljs-subst">=</span>dst</code></pre>   <h2 id="2-crear-la-vlan">2. Crear la VLAN</h2>   <h3 id="poner-initial-vlan-pvid-al-tráfico-que-llega-ingress-sin-tag-puertos-access">Poner initial VLAN (PVID) al tráfico que llega (ingress) sin tag (puertos access)</h3>   <pre class="prettyprint"><code class=" hljs lasso">/interface ethernet switch ingress<span class="hljs-attribute">-vlan</span><span class="hljs-attribute">-translation</span><br />add ports<span class="hljs-subst">=</span>ether10 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether11 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether12 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether13 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether14 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether15 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes<br />add ports<span class="hljs-subst">=</span>ether16 customer<span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">0</span> <span class="hljs-literal">new</span><span class="hljs-attribute">-customer</span><span class="hljs-attribute">-vid</span><span class="hljs-subst">=</span><span class="hljs-number">171</span> sa<span class="hljs-attribute">-learning</span><span class="hljs-subst">=</span>yes</code></pre>   <h3 id="trunkeamos-el-puerto-9-para-la-vlan171-los-paquetes-siempre-salen-egress-tageados">Trunkeamos el puerto 9 para la VLAN171. Los paquetes siempre salen (egress) tageados.</h3>   <pre class="prettyprint"><code class=" hljs lasso">/interface ethernet switch egress<span class="hljs-attribute">-vlan</span><span class="hljs-attribute">-tag</span><br />add tagged<span class="hljs-attribute">-ports</span><span class="hljs-subst">=</span>ether9 vlan<span class="hljs-attribute">-id</span><span class="hljs-subst">=</span><span class="hljs-number">171</span></code></pre>   <h3 id="editamos-tabla-de-pertenencia-de-puertos-a-vlans-para-que-el-tráfico-sea-válido">Editamos tabla de pertenencia de puertos a VLANs (para que el tráfico sea válido)</h3>   <pre class="prettyprint"><code class=" hljs cs">/<span class="hljs-keyword">interface</span> ethernet <span class="hljs-keyword">switch</span> vlan<br />add ports=ether9,ether10,ether11,ether12,ether13,ether14,ether15,ether16 vlan-id=<span class="hljs-number">171</span> learn=yes</code></pre>   <h3 id="deshabilitamos-tráfico-de-vlans-desconocidas">Deshabilitamos tráfico de VLANs desconocidas</h3>   <pre class="prettyprint"><code class=" hljs lasso">/interface ethernet switch<br /><span class="hljs-built_in">set</span> drop<span class="hljs-attribute">-if</span><span class="hljs-attribute">-invalid</span><span class="hljs-attribute">-or</span><span class="hljs-attribute">-src</span><span class="hljs-attribute">-port</span><span class="hljs-attribute">-not</span><span class="hljs-attribute">-member</span><span class="hljs-attribute">-of</span><span class="hljs-attribute">-vlan</span><span class="hljs-attribute">-on</span><span class="hljs-attribute">-ports</span><span class="hljs-subst">=</span>ether9,ether10,ether11,ether12,ether13,ether14,ether15,ether16</code></pre> <hr> <p>Fuentes:  <br><a href="http://wiki.mikrotik.com/wiki/Manual:CRS_examples">Manual Mikrotik</a> <br><a href="http://www.mikrotik-routeros.com/2014/05/crs-basic-vlan-configuration/">mikrotik-routeros.com</a> (Usa configuración tradicional)</p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>