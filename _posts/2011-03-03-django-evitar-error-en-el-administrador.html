---           
layout: post
title: Django Evitar error en el administrador "decoding Unicode is not supported"
date: 2011-02-24 17:52:40 UTC
comments: false
categories: django
---

Si, como es probable, os habéis encontrado con este error en el administrador cuando examináis modelos con caracteres utf-8, creo que puede deberse al hecho de que django sirve los strings en unicode pero sin codificar.<br /><br />En python, en el momento que intentamos algo como esto:<br /><code><br />>>> unicode('pepe', 'utf-8')<br />u'pepe'<br />>>> unicode(u'pepe', 'utf-8')<br /><br />Traceback (most recent call last):<br />File "<stdin>", line 1, in <module><br />TypeError: decoding Unicode is not supported<br /></module></stdin></code><br />Obtenemos el TypeError. En el admin de django, el error lo obtendremos siempre que grabemos caracteres >255. Parece provenir del hecho de codificar el unicode en ascii en vez de utf-8 ¿?.<br /><br />Si hacemos:<br /><code><br />def __unicode__(self):<br />   return unicode(self.descripcion)<br /></code><br /><br />Obtendremos el error de decodificación ascii, pero si hacemos...<br /><br /><code><br />def __unicode__(self):<br />   return unicode(self.descripcion, 'utf-8')<br /></code><br /><br />...nos funcionará pero no podremos usar el admin para examinar el modelo porque nos genera el error anterior.<br /><br />Tenemos dos posibilidades, aunque no las comprendo en profundidad:<br /><br />Solución 1):<br /><code><br />from django.utils.encoding import smart_unicode<br /></code><br />En los modelos poner:<br /><code><br />def __unicode__(self):<br />   return smart_unicode(("%s" % self.descripcion))<br /></code><br /><br />Solución 2) Llamado "método del literal"<br /><code><br />def __unicode__(self):<br />   return (u"%s" % self.descripcion)<br /></code><br /><br />En todo caso es conveniente poner el setting<br /><code><br />DEFAULT_CHARSET='utf-8'<br /></code><br />que fuerza utf-8 a la hora de procesar y servir las plantillas.<br /><br />Más info sobre este tema estaría bien. En mi caso uso mysql con utf-8 y ordenación spanish2, ubuntu 10.10 con utf-8 y apache forzado a servir utf-8.