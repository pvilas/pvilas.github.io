---
layout: post
title: Notebooks jupyter en pdf via pandoc
date: '2015-11-28T21:28:00.001+01:00'
author: Pere Vilas
tags:
- jupyter
- latex
- pandoc
- ipython
modified_time: '2015-11-29T22:26:58.071+01:00'
blogger_id: tag:blogger.com,1999:blog-9191328551308072706.post-3429400804298668758
blogger_orig_url: http://www.pvilas.com/2015/11/notebooks-jupyter-en-pdf-via-pandoc.html
---

Para poder controlar todos los detalles de la impresión de los notebooks de jupyter, podemos volcarlos primero a formato markdown y de ahí convertirlos a tex o pdf via pandoc. En general, el paso a pdf funciona muy bien con la plantilla <i>article</i> pero siempre hay detalles que podemos modificar en el tex que se genera de intermedio.<br /><br />Si queremos que pandoc nos genere el pdf directamente, hacemos<br /><br /><span style="font-family: Courier New, Courier, monospace;">``` convert.sh</span><br /><span style="font-family: Courier New, Courier, monospace;">jupyter nbconvert --to markdown $1.ipynb</span><br /><span style="font-family: Courier New, Courier, monospace;">pandoc $1.md -s -o $1.pdf</span><br /><span style="font-family: Courier New, Courier, monospace;">```</span><br /><br />Si queremos volcar antes a tex para editarlo<br /><br /><span style="font-family: Courier New, Courier, monospace;">``` convert_tex.sh</span><br /><span style="font-family: Courier New, Courier, monospace;">jupyter nbconvert --to markdown $1.ipynb</span><br /><span style="font-family: Courier New, Courier, monospace;">pandoc $1.md -f markdown -t latex -s -o $1.tex</span><br /><span style="font-family: Courier New, Courier, monospace;">```</span><br /><br />En realidad esto debería generar el mismo tex que exportar directamente desde jupyter.<br /><br /><h3>Personalizar manualmente el documento latex que genera pandoc</h3>Podemos personalizar el documento tex es añadiendo algunos comandos adicionales.<br /><h4>Idioma</h4>En la cabecera del documento<br /><br /><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><!--StartFragment--><span style="color: maroon;">\usepackage</span><span style="color: black;">[</span><span style="color: black; text-decoration: underline;">catalan</span><span style="color: black;">]{babel}</span></pre><br /><pre></pre><h4>Título del documento</h4>Justo antes del begin document<br /><br /><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><!--StartFragment--><span style="color: maroon;">\title</span><span style="color: black;">{<u>Títol del document</u></span> <span style="color: maroon;">\\</span> <span style="text-decoration: underline;">Autor</span>: <span style="text-decoration: underline;">Pere</span> <span style="text-decoration: underline;">Vilás</span>}</pre><br /><pre></pre>y justo después<br /><div style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><br /></div><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #0000cc;">\begin</span><span style="color: black;">{document}</span></pre><br /><pre></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: maroon;">\maketitle</span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: black;">    </span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: maroon;">\tableofcontents</span>    </pre><br /><pre><!--EndFragment--></pre>La razón de tener que poner el título a mano es que sale como sección y queda mal en el índice.<br /><h4>Imágenes</h4>Las imágenes salen del markdown sin tamaño, así que hay que ir una por una añadiendo el <i>width</i> o la <i>scale</i>. También se puede aprovecha para cambiar el <i>caption</i>:<br /><br /><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><!--StartFragment--><span style="color: #0000cc;">\begin</span><span style="color: black;">{figure}[</span><span style="color: black; text-decoration: underline;">htbp</span><span style="color: black;">]</span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: maroon;">\centering</span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #0000cc; font-weight: 600;">\includegraphics</span><span style="color: black;">[width=</span><span style="color: black; text-decoration: underline;">75mm</span><span style="color: black;">]{</span><span style="color: black; text-decoration: underline;">X1</span><span style="color: black;">.</span><span style="color: black; text-decoration: underline;">jpg</span><span style="color: black;">}</span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: maroon;">\caption</span><span style="color: black;">{</span><span style="color: black; text-decoration: underline;">X1</span><span style="color: black;">}</span></pre><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: #0000cc;">\end</span><span style="color: black;">{figure}</span></pre><pre style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"></pre><div style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><br /></div><h4 style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;">Saltos de página</h4><div style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;">Algunas veces las imágenes u otros elementos no quedan bien colocados, generalmente sólo hay que introducir algún final de página para que queden en su sitio.</div><div style="-qt-block-indent: 0; -qt-paragraph-type: empty; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><br /></div><pre style="-qt-block-indent: 0; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; text-indent: 0px;"><span style="color: maroon;">\newpage</span></pre><br /><h3>Usar metadatos de pandoc</h3><div>Este método de personalización es más automático que el anterior y no hay que editar el tex. Consiste en editar el markdown para añadir la cabecera al principio del documento. Las cabeceras de metadatos de makdown están en formato yaml y lucen tal que así (hay que poner las tres rayas de inicio y final):</div><div><br /></div><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">``` cabecera del documento markdown</span></div><div><div><span style="font-family: Courier New, Courier, monospace;">---</span></div><div><span style="font-family: Courier New, Courier, monospace;">title: Título del documento</span></div><div><span style="font-family: Courier New, Courier, monospace;">author: Pepe Pérez</span></div><div><span style="font-family: Courier New, Courier, monospace;">header-includes:</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \usepackage[utf8]{inputenc}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \usepackage[catalan]{babel}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \usepackage{fancyhdr}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \pagestyle{fancy}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \rhead{Universidad a distáncia}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \lhead{Asignatura xxxx}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \rfoot{\thepage}</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; - \fancyfoot[CO,CE]{Prueba3}</span></div><div><span style="font-family: Courier New, Courier, monospace;">toc:</span></div><div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; true</span></div><div><span style="font-family: Courier New, Courier, monospace;">---</span></div></div><div><span style="font-family: Courier New, Courier, monospace;">```</span></div><div><br /></div><div>Estos <a href="http://pandoc.org/README.html#yaml-metadata-block" target="_blank">metadatos</a> instruyen a pandoc para formatear el documento de salida. De esta forma podemos generar el pdf personalizado directamente a partir del md con</div><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">pandoc doc.md -o doc.pdf</span></div><div><br /></div><h3>Personalización máxima de la salida de pandoc</h3><div>También podemos modificar directamente la plantilla de pandoc personalizándola según nuestros intereses. Primero hacemos una copia de la plantilla por defecto con</div><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">pandoc -D latex &gt; plantilla.tex</span></div><div><br /></div><div>Personalizamos la plantilla y generamos el pdf&nbsp;</div><div><span style="background-color: white;"><br /></span></div><span style="background-color: white; color: #222222; line-height: 19.5px; white-space: pre-wrap;"><span style="font-family: Courier New, Courier, monospace;">pandoc -s -N --template=plantilla.tex doc.md -o doc.pdf</span></span><br /><div><br /></div><div><br /></div><div><br /></div><div><br /></div><pre><!--EndFragment--></pre><br /><div><br /></div>